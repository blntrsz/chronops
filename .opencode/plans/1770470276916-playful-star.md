# Plan
Goal: simple, consistent vitest/@effect/vitest tests for packages/domain; deterministic DateTime+ULID via reusable test runtime; inline snapshots; fix failures.

Steps
1) Inspect Effect DateTime/Clock API; pick stable mock (TestClock or DateTime layer). Build `packages/domain/src/test/runtime.ts`:
- fixed DateTime (e.g. 2024-01-01T00:00:00Z)
- ULID seq generator (deterministic ids)
- Actor service (member/org ids)
- export `TestRuntime` Layer + `runTest(effect)` to provide deps.
2) Standardize on vitest/@effect/vitest. Convert `packages/domain/src/pdf.test.ts` to vitest or move to `packages/domain/src/test/pdf.test.ts`.
3) Add minimal tests, each uses `runTest` + `toMatchInlineSnapshot`:
- base: makeBase/updateBase/removeBase
- framework/control/comment/schedule: make/update/remove
- schedule-run: make/markSuccess/markFailure
- pdf: make/markProcessing/markReady/markFailed/remove
- pdf-page: make/updateText/remove
- ai: VECTOR_DIMENSION + Vector decode (optional if trivial)
- workflow: keep as-is unless runtime helper needed
4) If snapshots noisy, encode to plain object before snapshot (Schema.encodeSync) and use same pattern everywhere.
5) Run tests; fix any failures/mocks/snapshots.

Files
- packages/domain/src/test/runtime.ts
- packages/domain/src/test/base.test.ts
- packages/domain/src/test/framework.test.ts
- packages/domain/src/test/control.test.ts
- packages/domain/src/test/comment.test.ts
- packages/domain/src/test/schedule.test.ts
- packages/domain/src/test/schedule-run.test.ts
- packages/domain/src/test/pdf-page.test.ts
- packages/domain/src/test/ai.test.ts (optional)
- packages/domain/src/pdf.test.ts (convert or move)
- packages/domain/src/test/workflow.test.ts (maybe update)

Verify
- bun test (from packages/domain)

Unresolved questions
- none
