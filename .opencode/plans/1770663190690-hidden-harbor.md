# Plan: Questioner domain + workflow + UI

## Goal
Implement Questioner as a new domain (not Assessment), with custom forms users fill. Workflow: draft -> active -> submitted. Org users only. Flat question list. One submission per instance. No scoring/evidence in v1. UI lives under existing assessment routes.

## Key decisions
- New domain entities: questioner_template + questioner_instance.
- Workflow applies to Questioner (instance) lifecycle; submitted is immutable.
- Question types: text, textarea, select, multiselect, number, date, boolean.
- Standalone v1 (no attachment to Control/Assessment/etc).

## Scope map (files)
Domain:
- `packages/domain/src/questioner-template.ts`
- `packages/domain/src/questioner-instance.ts`

Core:
- `packages/core/src/questioner/template/contract.ts`
- `packages/core/src/questioner/template/handler.ts`
- `packages/core/src/questioner/template/service.ts`
- `packages/core/src/questioner/template/sql.ts`
- `packages/core/src/questioner/instance/contract.ts`
- `packages/core/src/questioner/instance/handler.ts`
- `packages/core/src/questioner/instance/service.ts`
- `packages/core/src/questioner/instance/sql.ts`
- `packages/core/src/rpc.ts`
- `packages/core/src/contract.ts` (if contract exports are centralized)
- `packages/core/migrations/000X_questioner_template_instance.sql`

Web:
- `packages/web/src/features/questioner/_atom.tsx`
- `packages/web/src/features/questioner/create-template.tsx`
- `packages/web/src/features/questioner/create-instance.tsx`
- `packages/web/src/features/questioner/list-templates.tsx`
- `packages/web/src/features/questioner/list-instances.tsx`
- `packages/web/src/routes/org/$slug/assessment/index.tsx`
- `packages/web/src/routes/org/$slug/assessment/$id.tsx`
- `packages/web/src/routes/org/$slug/assessment-instance/$id.tsx`
- `packages/web/src/routeTree.gen.ts` (if route additions require regeneration)

## Data design
- questioner_template table
  - id, name, description, workflow_status
  - questions jsonb (flat array)
  - audit fields + org_id
- questioner_instance table
  - id, template_id, name
  - workflow_status (draft|active|submitted)
  - responses jsonb (keyed by question id)
  - submitted_at, submitted_by (set on submit)
  - audit fields + org_id

Question schema (domain):
- id, prompt, type, required, options[] (for select/multiselect)
- optional helpText, placeholder

Response schema:
- map questionId -> value (typed by question type)

## Implementation steps
1. Domain layer
   - Add questioner-template/instance models with workflow template (draft->active->submitted).
   - Add Create/Update schemas; include questions array on template; include responses on instance.
   - Add events + NotFound errors similar to assessment models.

2. DB + SQL
   - Add drizzle tables for template/instance with jsonb columns.
   - Create migration with tables + indexes on org_id, template_id.

3. Core services + RPC
   - Implement CRUD services mirroring assessment; enforce org scope.
   - Add submit RPC on instance: transition to submitted, set submitted_at/by; block update/remove after submitted.
   - Validate workflow transitions with Workflow helpers.

4. Web UI
   - Add questioner atoms for list/get/create/update/remove/submit.
   - Create template UI: name/description + question builder (flat list add/edit/remove).
   - Create instance UI: pick template, name, fill responses; submit action.
   - Surface lists under assessment routes (e.g., tab or section) without new top-level route.

5. Guardrails
   - Block edits to submitted instances (service + UI).
   - Validate required questions before submit.

## Verification
- `bun test` (if existing test suite is present)
- `bun scan:fix`
- Manual: create template -> create instance -> fill -> submit -> verify locked

## Unresolved questions
- None
