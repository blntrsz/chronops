# Questioner Primitive Implementation Plan

## Goal

Implement the Questioner primitive: "questions + response schema; scoring + evidence requests."

## Background

- Existing primitives (Tag, Comment) follow a consistent pattern
- Uses Effect-TS Schema for domain models
- Uses Effect RPC for API layer
- Soft delete + audit fields + org_id on all tables

## Open Questions

1. **Questions structure**: Should questions support multiple types (text, number, boolean, select, multi-select)? Should this be a JSON schema or typed structure?

2. **Response schema**: Is this validation schema for responses, or the actual response data? Or both (template vs instance)?

3. **Scoring**: Is scoring automated (based on answers) or manual review? Range (0-100, pass/fail, A-F)?

4. **Evidence requests**: Are these attachments required before answering, or optional supplemental evidence? Can questions mandate specific evidence types?

5. **Entity relationship**: Can a Questioner be attached to any entity (like Comment/Tag), or is it standalone? The reuse matrix says "Questioner uses Attachment, Comment, Approval" but doesn't specify what uses Questioner.

6. **Lifecycle**: Does Questioner have states (draft, active, closed)? Or is it versioned like Workflow method/template?

## Implementation (pending answers)

### Files to Create/Modify

**Domain layer** (`packages/domain/src/primitives/questioner.ts`):

- QuestionerId branded type with `qst_` prefix
- Questioner class extending Base
- Question type enum (text, number, boolean, select, multi_select)
- Question structure (text, type, options, required, evidenceRequired)
- Create/Update schemas
- Factory functions (make, update, remove)
- NotFoundError

**Database** (`packages/core/migrations/0004_questioner.ts`):

- questioner table (id, org_id, name, description, questions JSON, scoring_config JSON, status, audit fields, deleted_at)
- questioner_response table (id, questioner_id, entity_id, entity_type, responses JSON, score, submitted_at, submitted_by, reviewed_by, reviewed_at, status)

**Core layer** (`packages/core/src/questioner/`):

- contract.ts: RPC endpoints (Create, GetById, List, Update, Remove, ListResponses, SubmitResponse, ReviewResponse)
- service.ts: Repository pattern + custom queries
- handler.ts: Effect layer mapping

**Frontend** (`packages/web/src/features/questioner/`):

- RPC client atoms
- Questioner builder UI
- Response form UI
- Review/scoring UI

## Unresolved Questions

- [ ] Questions structure: typed vs JSON schema?
- [ ] Response schema: template validation vs response data?
- [ ] Scoring: automated vs manual, what scale?
- [ ] Evidence: required per question or optional?
- [ ] Entity attachment: what entities use Questioner?
- [ ] Lifecycle states: draft/active/closed or versioned?
